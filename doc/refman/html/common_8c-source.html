<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>FreeSDP: common.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>common.c</h1><a href="common_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment">  This file is part of FreeSDP</span>
00003 <span class="comment">  Copyright (C) 2001,2002,2003 Federico Montesino Pouzols &lt;fedemp@suidzer0.org&gt;</span>
00004 <span class="comment"></span>
00005 <span class="comment">  FreeSDP is free software; you can redistribute it and/or modify it</span>
00006 <span class="comment">  under the terms of the GNU General Public License as published by</span>
00007 <span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>
00008 <span class="comment">  (at your option) any later version.</span>
00009 <span class="comment"></span>
00010 <span class="comment">  This program is distributed in the hope that it will be useful,</span>
00011 <span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00012 <span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00013 <span class="comment">  GNU General Public License for more details.</span>
00014 <span class="comment"></span>
00015 <span class="comment">  You should have received a copy of the GNU General Public License</span>
00016 <span class="comment">  along with this program; if not, write to the Free Software</span>
00017 <span class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00018 <span class="comment">*/</span>
00019 
00030 <span class="preprocessor">#include "<a class="code" href="priv_8h.html">priv.h</a>"</span>
00031 <span class="preprocessor">#include &lt;<a class="code" href="common_8h.html">freesdp/common.h</a>&gt;</span>
00032 
00033 <a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a>*
<a name="l00034"></a><a class="code" href="group__common.html#a2">00034</a> <a class="code" href="group__common.html#a2">fsdp_description_new</a>(<span class="keywordtype">void</span>)
00035 {
00036   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
00037   <a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *result = malloc(<span class="keyword">sizeof</span>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a>));
00038   
00039   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o0">version</a> = 0;
00040   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o1">o_username</a> = result-&gt;<a class="code" href="structfsdp__description__t__s.html#o2">o_session_id</a> = 
00041     result-&gt;<a class="code" href="structfsdp__description__t__s.html#o3">o_announcement_version</a> = NULL; 
00042   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o4">o_network_type</a> = <a class="code" href="group__common.html#a7a34">FSDP_NETWORK_TYPE_UNDEFINED</a>;
00043   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o5">o_address_type</a> = <a class="code" href="group__common.html#a8a36">FSDP_ADDRESS_TYPE_UNDEFINED</a>;
00044   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o6">o_address</a> = NULL;
00045   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o7">s_name</a> = NULL;
00046   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o8">i_information</a> = NULL;
00047   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o9">u_uri</a> = NULL;
00048   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o10">emails</a> = NULL;
00049   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o11">emails_count</a> = 0;
00050   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o12">phones</a> = NULL;
00051   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o13">phones_count</a> = 0;
00052   <span class="comment">/* At first, there is no session-level definition for these</span>
00053 <span class="comment">     parameters */</span>
00054   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o14">c_network_type</a> = <a class="code" href="group__common.html#a7a34">FSDP_NETWORK_TYPE_UNDEFINED</a>;
00055   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o15">c_address_type</a> = <a class="code" href="group__common.html#a8a36">FSDP_ADDRESS_TYPE_UNDEFINED</a>;
00056   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o16">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o0">address</a> = NULL;
00057   <span class="comment">/* there is no session-level definition for these parameters */</span>
00058   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o17">bw_modifiers</a> = NULL;
00059   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o18">bw_modifiers_count</a> = 0;
00060   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a> = NULL;
00061   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o20">time_periods_count</a> = 0;
00062   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o21">timezone_adj</a> = NULL;
00063   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o22">k_encryption_method</a> = <a class="code" href="group__common.html#a10a45">FSDP_ENCRYPTION_METHOD_UNDEFINED</a>;
00064   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o23">k_encryption_content</a> = NULL;
00065   <span class="comment">/* Default/undefined values for attributes */</span>
00066   <span class="keywordflow">for</span> ( i = 0; i &lt; (<a class="code" href="group__common.html#a16a84">FSDP_LAST_SESSION_STR_ATT</a> + 1); i++ )
00067     result-&gt;<a class="code" href="structfsdp__description__t__s.html#o24">a_str_attributes</a>[i] = NULL;
00068   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o28">a_type</a> = <a class="code" href="group__common.html#a13a59">FSDP_SESSION_TYPE_UNDEFINED</a>;
00069   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o27">a_sendrecv_mode</a> = <a class="code" href="group__common.html#a11a50">FSDP_SENDRECV_UNDEFINED</a>;
00070   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o29">a_sdplangs</a> = result-&gt;<a class="code" href="structfsdp__description__t__s.html#o31">a_langs</a> = NULL;
00071   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o25">a_rtpmaps</a> = NULL;
00072   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o35">unidentified_attributes</a> = NULL;
00073   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o36">unidentified_attributes_count</a> = 0;
00074   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a> = NULL;
00075   result-&gt;<a class="code" href="structfsdp__description__t__s.html#o34">media_announcements_count</a> = 0;
00076 
00077   <span class="keywordflow">return</span> result;
00078 }
00079 
00080 <span class="keywordtype">void</span>
<a name="l00081"></a><a class="code" href="group__common.html#a3">00081</a> <a class="code" href="group__common.html#a3">fsdp_description_delete</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc)
00082 {
00083   <a class="code" href="group__common.html#a4">fsdp_description_recycle</a>(dsc);
00084   free(dsc);
00085 }
00086 
<a name="l00087"></a><a class="code" href="group__common.html#a4">00087</a> <span class="keywordtype">void</span> <a class="code" href="group__common.html#a4">fsdp_description_recycle</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc)
00088 {
00089   <span class="comment">/* Recursively free all strings and arrays */</span>
00090   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, j;
00091 
00092   <span class="keywordflow">if</span> ( NULL == dsc )
00093     <span class="keywordflow">return</span>;
00094 
00095   free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o1">o_username</a>);
00096   free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o2">o_session_id</a>);
00097   free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o3">o_announcement_version</a>);
00098   free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o6">o_address</a>);
00099   free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o7">s_name</a>);
00100   free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o8">i_information</a>);
00101   free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o9">u_uri</a>);
00102 
00103   <span class="keywordflow">for</span> ( i = 0; i &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o11">emails_count</a>; i++ )
00104     free((<span class="keywordtype">char</span>*)dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o10">emails</a>[i]);
00105   free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o10">emails</a>);
00106        
00107   <span class="keywordflow">for</span> ( i = 0; i &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o13">phones_count</a>; i++ )
00108     free((<span class="keywordtype">char</span>*)dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o12">phones</a>[i]);
00109   free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o12">phones</a>);
00110 
00111   free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o16">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o0">address</a>);
00112   <span class="keywordflow">for</span> ( i =0; i &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o18">bw_modifiers_count</a>; i++) {    
00113     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o17">bw_modifiers</a>[i].<a class="code" href="structfsdp__bw__modifier__t.html#o2">b_unknown_bw_modt</a>);
00114   }
00115   free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o17">bw_modifiers</a>);
00116 
00117   <span class="keywordflow">for</span> ( i = 0; i &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o20">time_periods_count</a>; i++ ) {
00118     <span class="keywordflow">for</span> ( j = 0; j &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>[i]-&gt;<a class="code" href="structfsdp__time__period__t.html#o3">repeats_count</a>; j++ ) {
00119       free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>[i]-&gt;<a class="code" href="structfsdp__time__period__t.html#o2">repeats</a>[j]-&gt;<a class="code" href="structfsdp__repeat__t.html#o2">offsets</a>);
00120       free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>[i]-&gt;<a class="code" href="structfsdp__time__period__t.html#o2">repeats</a>[j]);
00121     }
00122     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>[i]-&gt;<a class="code" href="structfsdp__time__period__t.html#o2">repeats</a>);
00123     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>[i]);
00124   }
00125   free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>);
00126 
00127 
00128   free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o21">timezone_adj</a>);
00129   <span class="keywordflow">for</span> ( i = 0; i &lt; (<a class="code" href="group__common.html#a16a84">FSDP_LAST_SESSION_STR_ATT</a> + 1); i++ )
00130     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o24">a_str_attributes</a>[i]);
00131   <span class="keywordflow">for</span> ( i = 0; i &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o26">a_rtpmaps_count</a>; i++ )
00132     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o25">a_rtpmaps</a>[i]);
00133   free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o25">a_rtpmaps</a>);
00134   <span class="keywordflow">for</span> ( i = 0; i &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o30">a_sdplangs_count</a>; i++ )
00135     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o29">a_sdplangs</a>[i]);
00136   free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o29">a_sdplangs</a>);
00137   <span class="keywordflow">for</span> ( i = 0; i &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o32">a_langs_count</a>; i++ )
00138     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o31">a_langs</a>[i]);
00139   free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o31">a_langs</a>);
00140 
00141   <span class="keywordflow">for</span> ( i = 0; i &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o34">media_announcements_count</a>; i++ ) {
00142     <span class="keywordflow">for</span> ( j = 0; j &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o5">formats_count</a>; j++ )
00143       free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o4">formats</a>[j]);
00144     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o4">formats</a>);
00145     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o6">i_title</a>);
00146     <span class="comment">/*    free((dsc-&gt;media_announcements[i]-&gt;c_address).address);*/</span>
00147     <span class="keywordflow">for</span> ( j = 0; j &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o11">bw_modifiers_count</a>; j ++ ) {
00148       <span class="keywordflow">if</span> ( <a class="code" href="group__common.html#a9a40">FSDP_BW_MOD_TYPE_UNKNOWN</a> == 
00149         dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o10">bw_modifiers</a>[j].<a class="code" href="structfsdp__bw__modifier__t.html#o0">b_mod_type</a> )
00150      free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o10">bw_modifiers</a>[j].<a class="code" href="structfsdp__bw__modifier__t.html#o2">b_unknown_bw_modt</a>);
00151     }
00152     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o10">bw_modifiers</a>);
00153     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o13">k_encryption_content</a>);
00154     <span class="keywordflow">for</span> ( j = 0; j &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o17">a_rtpmaps_count</a>; j++ ) {
00155       free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o16">a_rtpmaps</a>[j]-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o0">pt</a>);
00156       free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o16">a_rtpmaps</a>[j]-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o1">encoding_name</a>);
00157       free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o16">a_rtpmaps</a>[j]-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o3">parameters</a>);
00158       free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o16">a_rtpmaps</a>[j]);
00159     }
00160     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o16">a_rtpmaps</a>);
00161     <span class="keywordflow">for</span> ( j = 0; j &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o21">a_sdplangs_count</a>; j++ ) {
00162       free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o20">a_sdplangs</a>[j]);
00163     }
00164     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o20">a_sdplangs</a>);
00165     <span class="keywordflow">for</span> ( j = 0; j &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o23">a_langs_count</a>; j++ ) {
00166       free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o22">a_langs</a>[j]);
00167     }
00168     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o22">a_langs</a>);
00169     <span class="keywordflow">for</span> ( j = 0; j &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o27">a_fmtps_count</a>; j++ ) {
00170       free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o26">a_fmtps</a>[j]);
00171     }
00172     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o26">a_fmtps</a>);
00173     <span class="keywordflow">for</span> ( j = 0; 
00174        j &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o33">unidentified_attributes_count</a>; 
00175        j++ ) {
00176       free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o32">unidentified_attributes</a>[j]);
00177     }
00178     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o32">unidentified_attributes</a>);
00179     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i]);
00180   }
00181   free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>);   
00182 
00183   <span class="comment">/* This prevents the user to make the library crash when incorrectly</span>
00184 <span class="comment">     using recycled but not rebuilt descriptions */</span>
00185   dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o11">emails_count</a> = 0;
00186   dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o13">phones_count</a> = 0;
00187   dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o18">bw_modifiers_count</a> = 0;
00188   dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o20">time_periods_count</a> = 0;
00189   dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o34">media_announcements_count</a> = 0;
00190 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Jan 18 21:12:43 2004 for FreeSDP by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
