<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>FreeSDP: formatter.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>formatter.c</h1><a href="formatter_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment">  This file is part of FreeSDP</span>
00003 <span class="comment">  Copyright (C) 2001,2002,2003 Federico Montesino Pouzols &lt;fedemp@altern.org&gt;</span>
00004 <span class="comment">  </span>
00005 <span class="comment">  FreeSDP is free software; you can redistribute it and/or modify it</span>
00006 <span class="comment">  under the terms of the GNU General Public License as published by</span>
00007 <span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>
00008 <span class="comment">  (at your option) any later version.</span>
00009 <span class="comment"></span>
00010 <span class="comment">  This program is distributed in the hope that it will be useful,</span>
00011 <span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00012 <span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00013 <span class="comment">  GNU General Public License for more details.</span>
00014 <span class="comment"></span>
00015 <span class="comment">  You should have received a copy of the GNU General Public License</span>
00016 <span class="comment">  along with this program; if not, write to the Free Software</span>
00017 <span class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00018 <span class="comment">*/</span>
00019 
00026 <span class="preprocessor">#include "<a class="code" href="formatterpriv_8h.html">formatterpriv.h</a>"</span>
00027 
<a name="l00028"></a><a class="code" href="formatter_8c.html#a0">00028</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="formatter_8c.html#a0">bandwidth_modifier_strings</a>[] = {
00029   <span class="stringliteral">""</span>, <span class="stringliteral">""</span>, <span class="stringliteral">"CT"</span>, <span class="stringliteral">"AS"</span>, <span class="stringliteral">"RS"</span>, <span class="stringliteral">"RR"</span> 
00030 };
00031 
<a name="l00032"></a><a class="code" href="formatter_8c.html#a1">00032</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="formatter_8c.html#a1">network_type_strings</a>[] = {
00033   <span class="stringliteral">""</span>, <span class="stringliteral">"IN"</span>
00034 };
00035 
<a name="l00036"></a><a class="code" href="formatter_8c.html#a2">00036</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="formatter_8c.html#a2">address_type_strings</a>[] = {
00037   <span class="stringliteral">""</span>, <span class="stringliteral">"IP4"</span>, <span class="stringliteral">"IP6"</span>
00038 };
00039 
<a name="l00040"></a><a class="code" href="formatter_8c.html#a3">00040</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="formatter_8c.html#a3">bw_mod_type_strings</a>[] = {
00041   <span class="stringliteral">""</span>, <span class="stringliteral">"CT"</span>, <span class="stringliteral">"AS"</span>, <span class="stringliteral">"RS"</span>, <span class="stringliteral">"RR"</span>
00042 };
00043 
<a name="l00044"></a><a class="code" href="formatter_8c.html#a4">00044</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="formatter_8c.html#a4">encryption_method_strings</a>[] = {
00045   <span class="stringliteral">""</span>, <span class="stringliteral">"clear"</span>, <span class="stringliteral">"base64"</span>, <span class="stringliteral">"uri"</span>
00046 };
00047 
<a name="l00048"></a><a class="code" href="formatter_8c.html#a5">00048</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="formatter_8c.html#a5">sendrecv_mode_strings</a>[] = {
00049   <span class="stringliteral">""</span>, <span class="stringliteral">"sendrecv"</span>, <span class="stringliteral">"recvonly"</span>, <span class="stringliteral">"sendonly"</span>, <span class="stringliteral">"inactive"</span>
00050 }; 
00051 
<a name="l00052"></a><a class="code" href="formatter_8c.html#a6">00052</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="formatter_8c.html#a6">session_type_strings</a>[] = {
00053   <span class="stringliteral">""</span>, <span class="stringliteral">"broadcast"</span>, <span class="stringliteral">"meeting"</span>, <span class="stringliteral">"moderated"</span>, <span class="stringliteral">"test"</span>, <span class="stringliteral">"H332"</span>
00054 };
00055 
<a name="l00056"></a><a class="code" href="formatter_8c.html#a7">00056</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="formatter_8c.html#a7">media_strings</a>[] ={
00057   <span class="stringliteral">""</span>, <span class="stringliteral">"audio"</span>, <span class="stringliteral">"video"</span>, <span class="stringliteral">"text"</span>, <span class="stringliteral">"application"</span>, <span class="stringliteral">"data"</span>, <span class="stringliteral">"control"</span>
00058 };
00059 
<a name="l00060"></a><a class="code" href="formatter_8c.html#a8">00060</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="formatter_8c.html#a8">tp_strings</a>[] = {
00061   <span class="stringliteral">""</span>, <span class="stringliteral">"RTP/AVP"</span>, <span class="stringliteral">"udp"</span>, <span class="stringliteral">"TCP"</span>, <span class="stringliteral">"UDPTL"</span>, <span class="stringliteral">"vat"</span>, <span class="stringliteral">"rtp"</span>, <span class="stringliteral">"H.320"</span>
00062 };
00063 
<a name="l00064"></a><a class="code" href="formatter_8c.html#a9">00064</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="formatter_8c.html#a9">orient_strings</a>[] = {
00065   <span class="stringliteral">""</span>, <span class="stringliteral">"portrait"</span>, <span class="stringliteral">"landscape"</span>, <span class="stringliteral">"seascape"</span>
00066 };
00067 
00068 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00069"></a><a class="code" href="group__formatter.html#a0">00069</a> <a class="code" href="group__formatter.html#a0">fsdp_make_description</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> **dsc, 
00070                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sdp_version,
00071                 <span class="keyword">const</span> <span class="keywordtype">char</span> *session_name, <span class="keyword">const</span> <span class="keywordtype">char</span> *session_id,
00072                 <span class="keyword">const</span> <span class="keywordtype">char</span> *announcement_version,
00073                 <span class="keyword">const</span> <span class="keywordtype">char</span> *owner_username,
00074                 fsdp_network_type_t owner_nt, 
00075                 fsdp_address_type_t owner_at,
00076                 <span class="keyword">const</span> <span class="keywordtype">char</span> *owner_address,
00077                 time_t start, time_t stop)
00078 {
00079   <a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *obj; 
00080 
00081   <span class="keywordflow">if</span> ( (NULL == dsc) || (NULL == session_name) || (NULL == session_id) ||
00082        (NULL == announcement_version) ||
00083        (NULL == owner_username) || (NULL == owner_address) )
00084     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00085 
00086   *dsc = <a class="code" href="group__common.html#a2">fsdp_description_new</a>();
00087   obj = *dsc;
00088 
00089   <span class="comment">/* TODO: add sanity checks */</span>
00090   obj-&gt;<a class="code" href="structfsdp__description__t__s.html#o0">version</a> = sdp_version;
00091   obj-&gt;<a class="code" href="structfsdp__description__t__s.html#o1">o_username</a> = strdup(owner_username);
00092   obj-&gt;<a class="code" href="structfsdp__description__t__s.html#o2">o_session_id</a> = strdup(session_id);
00093   obj-&gt;<a class="code" href="structfsdp__description__t__s.html#o3">o_announcement_version</a> = strdup(announcement_version);
00094   obj-&gt;<a class="code" href="structfsdp__description__t__s.html#o4">o_network_type</a> = owner_nt;
00095   obj-&gt;<a class="code" href="structfsdp__description__t__s.html#o5">o_address_type</a> = owner_at;
00096   obj-&gt;<a class="code" href="structfsdp__description__t__s.html#o6">o_address</a> = strdup(owner_address);
00097   obj-&gt;<a class="code" href="structfsdp__description__t__s.html#o7">s_name</a> = strdup(session_name);
00098   obj-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a> = 
00099     calloc(<a class="code" href="formatterpriv_8h.html#a3">TIME_PERIODS_MAX_COUNT</a>,<span class="keyword">sizeof</span>(<a class="code" href="structfsdp__time__period__t.html">fsdp_time_period_t</a>*));
00100   obj-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>[0] = calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="structfsdp__time__period__t.html">fsdp_time_period_t</a>));
00101   obj-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>[0]-&gt;<a class="code" href="structfsdp__time__period__t.html#o0">start</a> = start;
00102   obj-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>[0]-&gt;<a class="code" href="structfsdp__time__period__t.html#o1">stop</a> = stop;
00103   obj-&gt;<a class="code" href="structfsdp__description__t__s.html#o20">time_periods_count</a> = 1;
00104   obj-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>[0]-&gt;<a class="code" href="structfsdp__time__period__t.html#o2">repeats</a> = 
00105     calloc(<a class="code" href="formatterpriv_8h.html#a4">REPEATS_MAX_COUNT</a>,<span class="keyword">sizeof</span>(<a class="code" href="structfsdp__repeat__t.html">fsdp_repeat_t</a>*));
00106   obj-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>[0]-&gt;<a class="code" href="structfsdp__time__period__t.html#o3">repeats_count</a> = 0;  
00107 
00108   <span class="comment">/* TODO: *dsc-&gt;built = 1; */</span>
00109   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00110 }
00111 
00112 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00113"></a><a class="code" href="group__formatter.html#a1">00113</a> <a class="code" href="group__formatter.html#a1">fsdp_format</a>(<span class="keyword">const</span> <a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, <span class="keywordtype">char</span> **text_description)
00114 {
00115   <span class="keywordtype">char</span> *result;
00116   size_t len = 1024;
00117 
00118   <span class="keywordflow">if</span> ( (NULL == dsc) || (NULL == text_description) )
00119     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00120 
00121   result = malloc(len);
00122 
00123   <span class="comment">/* iterative calls to */</span>
00124   <a class="code" href="group__formatter.html#a2">fsdp_format_bounded</a>(dsc,result,len);
00125 
00126   *text_description = result;
00127 
00128   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00129 }
00130 
00131 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00132"></a><a class="code" href="group__formatter.html#a2">00132</a> <a class="code" href="group__formatter.html#a2">fsdp_format_bounded</a>(<span class="keyword">const</span> <a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, <span class="keywordtype">char</span> *text_description, 
00133               size_t maxsize)
00134 {  
00135   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0, len = 0;
00136 
00137   <span class="keywordflow">if</span> ( (NULL == dsc) || (NULL == text_description) )
00138     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00139 
00140   <span class="comment">/* while ( len &lt; maxsize ) */</span>
00141   <span class="comment">/* `v=' line (protocol version) */</span>
00142   len += snprintf(text_description,100,<span class="stringliteral">"v=0\r\n"</span>);
00143 
00144   <span class="comment">/***************************************************************************/</span>
00145   <span class="comment">/* A) parse session-level description                                      */</span>
00146   <span class="comment">/***************************************************************************/</span>
00147   <span class="comment">/* o= line (owner/creator and session identifier). */</span>
00148   len += snprintf(text_description + len,100,
00149             <span class="stringliteral">"o=%s %s %s %2s %3s %s\r\n"</span>,dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o1">o_username</a>,
00150             dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o2">o_session_id</a>,dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o3">o_announcement_version</a>,
00151             <a class="code" href="formatter_8c.html#a1">network_type_strings</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o14">c_network_type</a>],
00152             <a class="code" href="formatter_8c.html#a2">address_type_strings</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o5">o_address_type</a>],dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o6">o_address</a>);
00153   
00154   <span class="comment">/* s= line (session name). */</span>
00155   len += snprintf(text_description + len,100,<span class="stringliteral">"s=%s\r\n"</span>,dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o7">s_name</a>);
00156 
00157   <span class="comment">/* `i=' line (session information) [optional] */</span>
00158   <span class="keywordflow">if</span> ( dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o8">i_information</a> != NULL )
00159     len += snprintf(text_description + len,100,<span class="stringliteral">"i=%s\r\n"</span>,dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o8">i_information</a>);
00160 
00161   <span class="comment">/* `u=' line (URI of description) [optional] */</span>
00162   <span class="keywordflow">if</span> ( dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o9">u_uri</a> != NULL )
00163     len += snprintf(text_description + len,100,<span class="stringliteral">"u=%s\r\n"</span>,dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o9">u_uri</a>);
00164 
00165   <span class="comment">/* `e=' lines (email address) [zero or more] */</span>
00166   <span class="keywordflow">for</span> ( i = 0; i &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o11">emails_count</a>; i++ ) {
00167     len += snprintf(text_description + len,100,<span class="stringliteral">"e=%s\r\n"</span>,dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o10">emails</a>[i]);
00168   }
00169 
00170   <span class="comment">/* `p=' lines (phone number) [zero or more] */</span>
00171   <span class="keywordflow">for</span> ( i = 0; i &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o13">phones_count</a>; i++ ) {
00172     len += snprintf(text_description + len,100,<span class="stringliteral">"p=%s\r\n"</span>,dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o12">phones</a>[i]);   
00173   }
00174 
00175   <span class="comment">/* `c=' line (connection information - not required if included in all media) [optional] */</span>
00176   <span class="keywordflow">if</span> ( <a class="code" href="group__common.html#a7a34">FSDP_NETWORK_TYPE_UNDEFINED</a> != dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o14">c_network_type</a> ) {
00177     <span class="keywordflow">if</span> ( 0 == dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o16">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o1">address_ttl</a> ) {
00178       len += snprintf(text_description + len,100,<span class="stringliteral">"c=%s %s %s\r\n"</span>,
00179                 <a class="code" href="formatter_8c.html#a1">network_type_strings</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o14">c_network_type</a>],
00180                 <a class="code" href="formatter_8c.html#a2">address_type_strings</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o15">c_address_type</a>],
00181                 dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o16">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o0">address</a>);
00182     } <span class="keywordflow">else</span> {
00183       <span class="keywordflow">if</span> ( 0 == dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o16">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o2">address_count</a> ) {
00184      len += snprintf(text_description + len,100,<span class="stringliteral">"c=%s %s %s/%d\r\n"</span>,
00185                <a class="code" href="formatter_8c.html#a1">network_type_strings</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o14">c_network_type</a>],
00186                <a class="code" href="formatter_8c.html#a2">address_type_strings</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o15">c_address_type</a>],
00187                dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o16">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o0">address</a>,dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o16">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o1">address_ttl</a>);
00188       } <span class="keywordflow">else</span> {
00189      len += snprintf(text_description + len,100,<span class="stringliteral">"c=%s %s %s/%d/%d\r\n"</span>,
00190                <a class="code" href="formatter_8c.html#a1">network_type_strings</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o14">c_network_type</a>],
00191                <a class="code" href="formatter_8c.html#a2">address_type_strings</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o15">c_address_type</a>],
00192                dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o16">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o0">address</a>,dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o16">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o1">address_ttl</a>,
00193                dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o16">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o2">address_count</a>);
00194       }
00195     }
00196   }
00197 
00198   <span class="comment">/* `b=' lines (bandwidth information) [optional] */</span>
00199   <span class="keywordflow">for</span> (i = 0; i &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o18">bw_modifiers_count</a>; i++) {
00200     <a class="code" href="group__common.html#a9">fsdp_bw_modifier_type_t</a> mt = dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o17">bw_modifiers</a>[i].<a class="code" href="structfsdp__bw__modifier__t.html#o0">b_mod_type</a>;
00201     <span class="keywordflow">if</span> ( <a class="code" href="group__common.html#a9a40">FSDP_BW_MOD_TYPE_UNKNOWN</a> == mt ) {
00202       len += snprintf(text_description + len,100,<span class="stringliteral">"b=%s:%lu\r\n"</span>,
00203                 dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o17">bw_modifiers</a>[i].<a class="code" href="structfsdp__bw__modifier__t.html#o2">b_unknown_bw_modt</a>,
00204                 dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o17">bw_modifiers</a>[i].<a class="code" href="structfsdp__bw__modifier__t.html#o1">b_value</a>);
00205     } <span class="keywordflow">else</span> {
00206       len += snprintf(text_description + len,100,<span class="stringliteral">"b=%s:%lu\r\n"</span>,
00207                 <a class="code" href="formatter_8c.html#a3">bw_mod_type_strings</a>[mt],dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o17">bw_modifiers</a>[i].<a class="code" href="structfsdp__bw__modifier__t.html#o1">b_value</a>);
00208     }      
00209   } 
00210 
00211   <span class="comment">/* `t=' lines (time the session is active) [1 or more] */</span>
00212   <span class="keywordflow">for</span> (i = 0; i &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o20">time_periods_count</a>; i++) {
00213     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j;
00214     len += snprintf(text_description + len,100,<span class="stringliteral">"t=%lu %lu\r\n"</span>,
00215               dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>[i]-&gt;<a class="code" href="structfsdp__time__period__t.html#o0">start</a> + <a class="code" href="priv_8h.html#a1">NTP_EPOCH_OFFSET</a>,
00216               dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>[i]-&gt;<a class="code" href="structfsdp__time__period__t.html#o1">stop</a> + <a class="code" href="priv_8h.html#a1">NTP_EPOCH_OFFSET</a>);
00217     
00218     <span class="comment">/* `r' lines [zero or more repeat times for each t=] */</span>
00219     <span class="keywordflow">for</span> ( j = 0; j &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>[i]-&gt;<a class="code" href="structfsdp__time__period__t.html#o3">repeats_count</a>; j++ ) {
00220       <a class="code" href="structfsdp__repeat__t.html">fsdp_repeat_t</a> *repeat = dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>[i]-&gt;<a class="code" href="structfsdp__time__period__t.html#o2">repeats</a>[j];
00221       len += snprintf(text_description + len,100,<span class="stringliteral">"r=%lu %lu %lu\r\n"</span>,
00222                 repeat-&gt;<a class="code" href="structfsdp__repeat__t.html#o0">interval</a>, repeat-&gt;<a class="code" href="structfsdp__repeat__t.html#o1">duration</a>, 
00223                 repeat-&gt;<a class="code" href="structfsdp__repeat__t.html#o2">offsets</a>[0]); <span class="comment">/* FIX offsets */</span>
00224     }
00225   }
00226   
00227   <span class="comment">/* `z=' line (time zone adjustments) [zero or more] */</span>
00228   <span class="keywordflow">if</span> ( NULL != dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o21">timezone_adj</a>)
00229     len += snprintf(text_description + len,100,<span class="stringliteral">"z=%s\r\n"</span>,dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o21">timezone_adj</a>);
00230 
00231   <span class="comment">/* `k=' line (encryption key) [optional] */</span>
00232   <span class="keywordflow">if</span> ( <a class="code" href="group__common.html#a10a45">FSDP_ENCRYPTION_METHOD_UNDEFINED</a> == dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o22">k_encryption_method</a> ) {
00233     ;
00234   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="group__common.html#a10a49">FSDP_ENCRYPTION_METHOD_PROMPT</a> == dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o22">k_encryption_method</a> ) {
00235     len += snprintf(text_description + len,100,<span class="stringliteral">"k=prompt\r\n"</span>);
00236   } <span class="keywordflow">else</span> {
00237     len += snprintf(text_description + len,100,<span class="stringliteral">"k=%s:%s\r\n"</span>,
00238               <a class="code" href="formatter_8c.html#a4">encryption_method_strings</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o22">k_encryption_method</a>],
00239               dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o23">k_encryption_content</a>);
00240   }
00241 
00242   <span class="comment">/* `a=' lines (zero or more session attribute lines) [optional] */</span>
00243   {
00244     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j;
00245 
00246     <span class="keywordflow">if</span> ( NULL != dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o24">a_str_attributes</a>[<a class="code" href="group__common.html#a16a80">FSDP_SESSION_STR_ATT_CATEGORY</a>] )
00247       len += snprintf(text_description + len,100,<span class="stringliteral">"a=cat:%s\r\n"</span>,
00248                 dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o24">a_str_attributes</a>[<a class="code" href="group__common.html#a16a80">FSDP_SESSION_STR_ATT_CATEGORY</a>]);
00249 
00250     <span class="keywordflow">if</span> ( NULL != dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o24">a_str_attributes</a>[<a class="code" href="group__common.html#a16a80">FSDP_SESSION_STR_ATT_CATEGORY</a>] )
00251       len += snprintf(text_description + len,100,<span class="stringliteral">"a=keywds:%s\r\n"</span>,
00252                 dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o24">a_str_attributes</a>[<a class="code" href="group__common.html#a16a80">FSDP_SESSION_STR_ATT_CATEGORY</a>]);
00253 
00254     <span class="keywordflow">if</span> ( NULL != dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o24">a_str_attributes</a>[<a class="code" href="group__common.html#a16a82">FSDP_SESSION_STR_ATT_TOOL</a>] )
00255       len += snprintf(text_description + len,100,<span class="stringliteral">"a=tool:%s\r\n"</span>,
00256                 dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o24">a_str_attributes</a>[<a class="code" href="group__common.html#a16a82">FSDP_SESSION_STR_ATT_TOOL</a>]);
00257 
00258     <span class="keywordflow">for</span> ( j = 0; j &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o26">a_rtpmaps_count</a>; j++ ) {
00259       <a class="code" href="structfsdp__rtpmap__t.html">fsdp_rtpmap_t</a> *rtpmap = dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o25">a_rtpmaps</a>[j];
00260       <span class="keywordflow">if</span> ( NULL == rtpmap-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o3">parameters</a> )
00261      len += snprintf(text_description + len,100,
00262                <span class="stringliteral">"a=rtpmap:%s %s/%u\r\n"</span>,
00263                rtpmap-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o0">pt</a>,rtpmap-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o1">encoding_name</a>,rtpmap-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o2">clock_rate</a>);
00264       <span class="keywordflow">else</span>
00265      len += snprintf(text_description + len,100,
00266                <span class="stringliteral">"a=rtpmap:%s %s/%u/%s\r\n"</span>,
00267                rtpmap-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o0">pt</a>,rtpmap-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o1">encoding_name</a>,rtpmap-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o2">clock_rate</a>,
00268                rtpmap-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o3">parameters</a>);
00269     }
00270 
00271     <span class="keywordflow">if</span> ( <a class="code" href="group__common.html#a11a50">FSDP_SENDRECV_UNDEFINED</a> != dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o27">a_sendrecv_mode</a> )
00272       len += snprintf(text_description + len,100,<span class="stringliteral">"a=%s\r\n"</span>,
00273                 <a class="code" href="formatter_8c.html#a5">sendrecv_mode_strings</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o27">a_sendrecv_mode</a>]);
00274 
00275     <span class="keywordflow">if</span> ( <a class="code" href="group__common.html#a13a59">FSDP_SESSION_TYPE_UNDEFINED</a> != dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o28">a_type</a> )
00276       len += snprintf(text_description + len,100,<span class="stringliteral">"a=type:%s\r\n"</span>,
00277                 <a class="code" href="formatter_8c.html#a6">session_type_strings</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o28">a_type</a>]);
00278 
00279     <span class="keywordflow">if</span> ( NULL != dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o24">a_str_attributes</a>[<a class="code" href="group__common.html#a16a83">FSDP_SESSION_STR_ATT_CHARSET</a>] )
00280       len += snprintf(text_description + len,100,<span class="stringliteral">"a=charset:%s\r\n"</span>,
00281                 dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o24">a_str_attributes</a>[<a class="code" href="group__common.html#a16a83">FSDP_SESSION_STR_ATT_CHARSET</a>]);
00282 
00283     <span class="keywordflow">for</span> ( j = 0; j &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o30">a_sdplangs_count</a>; j++ ) {
00284       len += snprintf(text_description + len,100,<span class="stringliteral">"a=sdplang:%s\r\n"</span>,
00285                 dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o29">a_sdplangs</a>[j]);
00286     }
00287 
00288     <span class="keywordflow">for</span> ( j = 0; j &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o32">a_langs_count</a>; j++ ) {
00289       len += snprintf(text_description + len,100,<span class="stringliteral">"a=lang:%s\r\n"</span>,
00290                 dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o31">a_langs</a>[j]);
00291     }
00292 
00293     <span class="comment">/* attributes not recognized by FreeSDP */</span>
00294     <span class="keywordflow">for</span> ( j = 0; j &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o36">unidentified_attributes_count</a>; j++ ) {
00295       len += snprintf(text_description + len,100,<span class="stringliteral">"a=%s\r\n"</span>,
00296                 dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o35">unidentified_attributes</a>[j]);
00297     }
00298   }
00299 
00300   <span class="comment">/***************************************************************************/</span>
00301   <span class="comment">/* B) print media-level descriptions                                       */</span>
00302   <span class="comment">/***************************************************************************/</span>
00303   <span class="keywordflow">for</span> ( i = 0; i &lt; dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o34">media_announcements_count</a>; i++) {
00304     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j;
00305     <a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_announcement_t</a> *ann = dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[i];
00306     {       <span class="comment">/* `m=' line (media name, transport address and format list) */</span>
00307       <span class="keywordflow">if</span> ( 0 == ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o2">port_count</a> )
00308      len += snprintf(text_description + len,100,<span class="stringliteral">"m=%s %d %s"</span>,
00309                <a class="code" href="formatter_8c.html#a7">media_strings</a>[ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o0">media_type</a>],ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o1">port</a>,
00310                <a class="code" href="formatter_8c.html#a8">tp_strings</a>[ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o3">transport</a>]);
00311       <span class="keywordflow">else</span>
00312      len += snprintf(text_description + len,100,<span class="stringliteral">"m=%s %d/%d %s"</span>,
00313                <a class="code" href="formatter_8c.html#a7">media_strings</a>[ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o0">media_type</a>],
00314                ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o1">port</a>,ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o2">port_count</a>,
00315                <a class="code" href="formatter_8c.html#a8">tp_strings</a>[ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o3">transport</a>]);
00316      
00317       <span class="keywordflow">for</span> ( j = 0; j &lt; ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o5">formats_count</a>; j++ )
00318      len += snprintf(text_description + len,100,<span class="stringliteral">" %s"</span>,ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o4">formats</a>[j]);
00319       len += snprintf(text_description + len,100,<span class="stringliteral">"\r\n"</span>);
00320     }
00321 
00322     <span class="keywordflow">if</span> ( ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o6">i_title</a> != NULL )
00323       len += snprintf(text_description + len,100,<span class="stringliteral">"i=%s\r\n"</span>,
00324                 ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o6">i_title</a>);
00325     
00326     <span class="keywordflow">if</span> ( <a class="code" href="group__common.html#a7a34">FSDP_NETWORK_TYPE_UNDEFINED</a> != ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o7">c_network_type</a> ) {
00327       <span class="keywordflow">if</span> ( 0 == ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o9">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o1">address_ttl</a> ) {
00328      len += snprintf(text_description + len,100,<span class="stringliteral">"c=%s %s %s\r\n"</span>,
00329                <a class="code" href="formatter_8c.html#a1">network_type_strings</a>[ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o7">c_network_type</a>],
00330                <a class="code" href="formatter_8c.html#a2">address_type_strings</a>[ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o8">c_address_type</a>],
00331                ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o9">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o0">address</a>);
00332       } <span class="keywordflow">else</span> {
00333      <span class="keywordflow">if</span> ( 0 == ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o9">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o2">address_count</a> ) {
00334        len += snprintf(text_description + len,100,<span class="stringliteral">"c=%s %s %s/%d\r\n"</span>,
00335                  <a class="code" href="formatter_8c.html#a1">network_type_strings</a>[ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o7">c_network_type</a>],
00336                  <a class="code" href="formatter_8c.html#a2">address_type_strings</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o15">c_address_type</a>],
00337                  ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o9">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o0">address</a>,ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o9">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o1">address_ttl</a>);
00338      } <span class="keywordflow">else</span> {
00339        len += snprintf(text_description + len,100,<span class="stringliteral">"c=%s %s %s/%d/%d\r\n"</span>,
00340                  <a class="code" href="formatter_8c.html#a1">network_type_strings</a>[ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o7">c_network_type</a>],
00341                  <a class="code" href="formatter_8c.html#a2">address_type_strings</a>[ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o8">c_address_type</a>],
00342                  ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o9">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o0">address</a>,ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o9">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o1">address_ttl</a>,
00343                  ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o9">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o2">address_count</a>);
00344      }
00345       }
00346     }
00347   
00348     <span class="comment">/* `b=' lines (bandwidth information) [optional] */</span>
00349     <span class="keywordflow">for</span> (j = 0; j &lt; ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o11">bw_modifiers_count</a>; j++) {
00350       <a class="code" href="group__common.html#a9">fsdp_bw_modifier_type_t</a> mt = ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o10">bw_modifiers</a>[j].<a class="code" href="structfsdp__bw__modifier__t.html#o0">b_mod_type</a>;
00351       <span class="keywordflow">if</span> ( <a class="code" href="group__common.html#a9a40">FSDP_BW_MOD_TYPE_UNKNOWN</a> == mt )
00352      len += snprintf(text_description + len,100,<span class="stringliteral">"b=%s:%lu\r\n"</span>,
00353                ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o10">bw_modifiers</a>[j].<a class="code" href="structfsdp__bw__modifier__t.html#o2">b_unknown_bw_modt</a>,
00354                ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o10">bw_modifiers</a>[j].<a class="code" href="structfsdp__bw__modifier__t.html#o1">b_value</a>);
00355       <span class="keywordflow">else</span>
00356      len += snprintf(text_description + len,100,<span class="stringliteral">"b=%s:%lu\r\n"</span>,
00357                <a class="code" href="formatter_8c.html#a0">bandwidth_modifier_strings</a>[ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o10">bw_modifiers</a>[j].<a class="code" href="structfsdp__bw__modifier__t.html#o0">b_mod_type</a>],
00358                ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o10">bw_modifiers</a>[j].<a class="code" href="structfsdp__bw__modifier__t.html#o1">b_value</a>);
00359     }
00360 
00361     <span class="comment">/* `k=' line (encryption key) [optional] */</span>
00362     <span class="keywordflow">if</span> ( <a class="code" href="group__common.html#a10a45">FSDP_ENCRYPTION_METHOD_UNDEFINED</a> == ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o12">k_encryption_method</a> ) {
00363       ;
00364     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="group__common.html#a10a49">FSDP_ENCRYPTION_METHOD_PROMPT</a> == ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o12">k_encryption_method</a> ) {
00365       len += snprintf(text_description + len,100,<span class="stringliteral">"k=prompt\r\n"</span>);
00366     } <span class="keywordflow">else</span> {
00367       len += snprintf(text_description + len,100,<span class="stringliteral">"k=%s:%s\r\n"</span>,
00368                 <a class="code" href="formatter_8c.html#a4">encryption_method_strings</a>[ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o12">k_encryption_method</a>],
00369                 ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o13">k_encryption_content</a>);
00370     }
00371 
00372     <span class="comment">/* `a=' lines (zero or more media attribute lines) [optional] */</span>
00373     <span class="keywordflow">if</span> ( 0 != ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o14">a_ptime</a> )
00374       len += snprintf(text_description + len,100,<span class="stringliteral">"a=ptime:%lu\r\n"</span>,
00375                 ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o14">a_ptime</a>);
00376 
00377     <span class="keywordflow">if</span> ( 0 != ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o15">a_maxptime</a> )
00378       len += snprintf(text_description + len,100,<span class="stringliteral">"a=maxptime:%lu\r\n"</span>,
00379                 ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o15">a_maxptime</a>);
00380 
00381     <span class="keywordflow">for</span> ( j = 0; j &lt; ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o17">a_rtpmaps_count</a>; j++ ) {
00382       <a class="code" href="structfsdp__rtpmap__t.html">fsdp_rtpmap_t</a> *rtpmap = ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o16">a_rtpmaps</a>[j];
00383       <span class="keywordflow">if</span> ( NULL == rtpmap-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o3">parameters</a> )
00384      len += snprintf(text_description + len,100,
00385                <span class="stringliteral">"a=rtpmap:%s %s/%u\r\n"</span>,
00386                rtpmap-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o0">pt</a>,rtpmap-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o1">encoding_name</a>,rtpmap-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o2">clock_rate</a>);
00387       <span class="keywordflow">else</span>
00388      len += snprintf(text_description + len,100,
00389                <span class="stringliteral">"a=rtpmap:%s %s/%u/%s\r\n"</span>,
00390                rtpmap-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o0">pt</a>,rtpmap-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o1">encoding_name</a>,rtpmap-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o2">clock_rate</a>,
00391                rtpmap-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o3">parameters</a>);
00392     }
00393 
00394     <span class="keywordflow">if</span> ( <a class="code" href="group__common.html#a12a55">FSDP_ORIENT_UNDEFINED</a> != ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o18">a_orient</a> )
00395       len += snprintf(text_description + len,100,<span class="stringliteral">"a=orient:%s\r\n"</span>,
00396                 <a class="code" href="formatter_8c.html#a9">orient_strings</a>[ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o18">a_orient</a>]);
00397 
00398     <span class="keywordflow">if</span> ( <a class="code" href="group__common.html#a11a50">FSDP_SENDRECV_UNDEFINED</a> != ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o19">a_sendrecv_mode</a> )
00399       len += snprintf(text_description + len,100,<span class="stringliteral">"a=%s\r\n"</span>,
00400                 <a class="code" href="formatter_8c.html#a5">sendrecv_mode_strings</a>[ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o19">a_sendrecv_mode</a>]);
00401 
00402     <span class="keywordflow">for</span> ( j = 0; j &lt; ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o21">a_sdplangs_count</a>; j++ ) {
00403       len += snprintf(text_description + len,100,<span class="stringliteral">"a=sdplang:%s\r\n"</span>,
00404                 ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o20">a_sdplangs</a>[j]);
00405     }
00406 
00407     <span class="keywordflow">for</span> ( j = 0; j &lt; ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o23">a_langs_count</a>; j++ ) {
00408       len += snprintf(text_description + len,100,<span class="stringliteral">"a=lang:%s\r\n"</span>,
00409                 ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o22">a_langs</a>[j]);
00410     }
00411 
00412     <span class="keywordflow">if</span> ( 0.0 != ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o24">a_framerate</a> )
00413       len += snprintf(text_description + len,100,<span class="stringliteral">"a=framerate:%f\r\n"</span>,
00414                 ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o24">a_framerate</a>);
00415 
00416     <span class="keywordflow">if</span> ( 0 != ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o25">a_quality</a> )
00417       len += snprintf(text_description + len,100,<span class="stringliteral">"a=quality:%ul\r\n"</span>,
00418                 ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o25">a_quality</a>);
00419     
00420     <span class="keywordflow">for</span> ( j = 0; j &lt; ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o27">a_fmtps_count</a>; j++ ) {
00421       len += snprintf(text_description + len,100,<span class="stringliteral">"a=lang:%s\r\n"</span>,
00422                 ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o26">a_fmtps</a>[j]);
00423     }
00424 
00425     <span class="keywordflow">if</span> ( NULL != ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o31">a_rtcp_address</a> ) {
00426       len += snprintf(text_description + len,100,<span class="stringliteral">"a=rtcp:%u %s %s %s\r\n"</span>,
00427                 ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o28">a_rtcp_port</a>,
00428                 <a class="code" href="formatter_8c.html#a1">network_type_strings</a>[ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o29">a_rtcp_network_type</a>],
00429                 <a class="code" href="formatter_8c.html#a2">address_type_strings</a>[ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o30">a_rtcp_address_type</a>],
00430                 ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o31">a_rtcp_address</a>);
00431     }
00432 
00433     <span class="comment">/* attributes not recognized by FreeSDP */</span>
00434     <span class="keywordflow">for</span> ( j = 0; j &lt; ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o33">unidentified_attributes_count</a>; j++ ) {
00435       len += snprintf(text_description + len,100,<span class="stringliteral">"a=%s\r\n"</span>,
00436                 ann-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o32">unidentified_attributes</a>[j]);
00437     }
00438   }
00439 
00440   <span class="comment">/* this should be a macro: */</span>
00441   <span class="keywordflow">if</span> ( (len + 5) &gt; maxsize ) 
00442     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a33">FSDPE_BUFFER_OVERFLOW</a>;
00443   len += 5;
00444   
00445   <span class="comment">/* strncpy */</span>
00446   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a31">FSDPE_INTERNAL_ERROR</a>;
00447 }
00448 
00449 
00450 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00451"></a><a class="code" href="group__formatter.html#a3">00451</a> <a class="code" href="group__formatter.html#a3">fsdp_set_information</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, <span class="keyword">const</span> <span class="keywordtype">char</span> *info)
00452 {
00453   <span class="keywordflow">if</span> ( (NULL == dsc) || (NULL == info) )
00454     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00455 
00456   <span class="keywordflow">if</span> ( NULL != dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o8">i_information</a> )
00457     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o8">i_information</a>);
00458   dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o8">i_information</a> = strdup(info);
00459   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00460 }
00461 
00462 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00463"></a><a class="code" href="group__formatter.html#a4">00463</a> <a class="code" href="group__formatter.html#a4">fsdp_set_uri</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, <span class="keyword">const</span> <span class="keywordtype">char</span> *uri)
00464 {
00465   <span class="keywordflow">if</span> ( (NULL == dsc) || (NULL == uri) )
00466     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00467 
00468   <span class="keywordflow">if</span> ( NULL != dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o9">u_uri</a> )
00469     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o9">u_uri</a>);
00470   dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o9">u_uri</a> = strdup(uri);
00471   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00472 }
00473 
00474 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00475"></a><a class="code" href="group__formatter.html#a5">00475</a> <a class="code" href="group__formatter.html#a5">fsdp_add_email</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, <span class="keywordtype">char</span> *email)
00476 {
00477   <span class="keywordflow">if</span> ( (NULL == dsc) || (NULL == email) ) {
00478     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00479   } 
00480   <span class="keywordflow">if</span> ( NULL == dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o10">emails</a> ) {
00481     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o11">emails_count</a> = 0;
00482     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o10">emails</a> = calloc(<a class="code" href="formatterpriv_8h.html#a0">EMAILS_MAX_COUNT</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00483   }
00484   <span class="keywordflow">if</span> ( dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o11">emails_count</a> &lt; <a class="code" href="formatterpriv_8h.html#a0">EMAILS_MAX_COUNT</a> ) <span class="comment">/* FIX */</span>
00485     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o10">emails</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o11">emails_count</a>++] = strdup(email);
00486 
00487   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00488 }
00489 
00490 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00491"></a><a class="code" href="group__formatter.html#a6">00491</a> <a class="code" href="group__formatter.html#a6">fsdp_add_phone</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, <span class="keywordtype">char</span> *phone)
00492 {
00493   <span class="keywordflow">if</span> ( (NULL == dsc) || (NULL == phone) ) {
00494     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00495   } 
00496   <span class="keywordflow">if</span> ( NULL == dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o12">phones</a> ) {
00497     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o13">phones_count</a> = 0;
00498     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o12">phones</a> = calloc(<a class="code" href="formatterpriv_8h.html#a1">PHONES_MAX_COUNT</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00499   }
00500   <span class="keywordflow">if</span> ( dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o13">phones_count</a> &lt; <a class="code" href="formatterpriv_8h.html#a1">PHONES_MAX_COUNT</a> ) <span class="comment">/* FIX */</span>
00501     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o12">phones</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o13">phones_count</a>++] = strdup(phone);
00502 
00503   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00504 }
00505 
00506 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00507"></a><a class="code" href="group__formatter.html#a7">00507</a> <a class="code" href="group__formatter.html#a7">fsdp_set_conn_address</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, fsdp_network_type_t nt,
00508                 fsdp_address_type_t at, <span class="keyword">const</span> <span class="keywordtype">char</span> *address,
00509                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> address_ttl, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> address_count)
00510 {
00511   <span class="keywordflow">if</span> ( (NULL == dsc) || (NULL == address) ) {
00512     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00513   }
00514   dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o14">c_network_type</a> = nt;
00515   dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o15">c_address_type</a> = at;
00516   <span class="keywordflow">if</span> ( NULL != dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o16">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o0">address</a> )
00517     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o16">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o0">address</a>);
00518   dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o16">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o0">address</a> = strdup(address);
00519   dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o16">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o1">address_ttl</a> = address_ttl;
00520   dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o16">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o2">address_count</a> = address_count;
00521   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00522 }
00523 
00524 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00525"></a><a class="code" href="group__formatter.html#a8">00525</a> <a class="code" href="group__formatter.html#a8">fsdp_add_bw_info</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc,
00526            fsdp_bw_modifier_type_t mt, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> value, 
00527            <span class="keyword">const</span> <span class="keywordtype">char</span> *unk_bmt)
00528 {
00529   <span class="keywordflow">if</span> ( (NULL == dsc) ||
00530        ((<a class="code" href="group__common.html#a9a40">FSDP_BW_MOD_TYPE_UNKNOWN</a> == mt) &amp;&amp; (NULL == unk_bmt)) ) {
00531     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00532   }
00533   <span class="keywordflow">if</span> ( NULL == dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o17">bw_modifiers</a> ) {
00534     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o18">bw_modifiers_count</a> = 0;
00535     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o17">bw_modifiers</a> = 
00536       calloc(<a class="code" href="formatterpriv_8h.html#a2">BW_MODIFIERS_MAX_COUNT</a>,<span class="keyword">sizeof</span>(<a class="code" href="structfsdp__bw__modifier__t.html">fsdp_bw_modifier_t</a>));
00537   }
00538   <span class="keywordflow">if</span> ( dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o18">bw_modifiers_count</a> &lt; <a class="code" href="formatterpriv_8h.html#a2">BW_MODIFIERS_MAX_COUNT</a> ) { <span class="comment">/* FIX */</span>
00539     <a class="code" href="structfsdp__bw__modifier__t.html">fsdp_bw_modifier_t</a> *bwm = &amp;(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o17">bw_modifiers</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o18">bw_modifiers_count</a>]);
00540     bwm-&gt;<a class="code" href="structfsdp__bw__modifier__t.html#o0">b_mod_type</a> = mt;
00541     bwm-&gt;<a class="code" href="structfsdp__bw__modifier__t.html#o1">b_value</a> = value;
00542     <span class="keywordflow">if</span> ( <a class="code" href="group__common.html#a9a40">FSDP_BW_MOD_TYPE_UNKNOWN</a> == mt) {
00543       bwm-&gt;<a class="code" href="structfsdp__bw__modifier__t.html#o2">b_unknown_bw_modt</a> = strdup(unk_bmt);
00544     }
00545     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o18">bw_modifiers_count</a>++;
00546   }
00547 
00548   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00549 }
00550 
00551 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00552"></a><a class="code" href="group__formatter.html#a9">00552</a> <a class="code" href="group__formatter.html#a9">fsdp_add_period</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, time_t start, time_t stop)
00553 {
00554   <span class="keywordflow">if</span> ( (NULL == dsc) )
00555     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00556   
00557   <span class="keywordflow">if</span> ( dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o20">time_periods_count</a> &lt; <a class="code" href="formatterpriv_8h.html#a3">TIME_PERIODS_MAX_COUNT</a> ) {
00558     <span class="comment">/* FIX */</span>
00559     <a class="code" href="structfsdp__time__period__t.html">fsdp_time_period_t</a> *period;
00560     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o20">time_periods_count</a>] = 
00561       calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="structfsdp__time__period__t.html">fsdp_time_period_t</a>));
00562     period = dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o20">time_periods_count</a>];
00563     period-&gt;<a class="code" href="structfsdp__time__period__t.html#o0">start</a> = start;
00564     period-&gt;<a class="code" href="structfsdp__time__period__t.html#o1">stop</a> = stop;
00565     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o20">time_periods_count</a>++;
00566   }
00567   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00568 }
00569 
00570 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00571"></a><a class="code" href="group__formatter.html#a10">00571</a> <a class="code" href="group__formatter.html#a10">fsdp_add_repeat</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> interval,
00572           <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> duration, <span class="keyword">const</span> <span class="keywordtype">char</span> *offsets)
00573 {
00574   <a class="code" href="structfsdp__time__period__t.html">fsdp_time_period_t</a> *period;
00575   
00576   <span class="keywordflow">if</span> ( (NULL == dsc) || (NULL == offsets) )
00577     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00578 
00579   period = dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o19">time_periods</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o20">time_periods_count</a>];
00580   <span class="keywordflow">if</span> ( NULL == period-&gt;<a class="code" href="structfsdp__time__period__t.html#o2">repeats</a> ) {
00581     period-&gt;<a class="code" href="structfsdp__time__period__t.html#o3">repeats_count</a> = 0;
00582     period-&gt;<a class="code" href="structfsdp__time__period__t.html#o2">repeats</a> = 
00583       calloc(<a class="code" href="formatterpriv_8h.html#a4">REPEATS_MAX_COUNT</a>,<span class="keyword">sizeof</span>(<a class="code" href="structfsdp__repeat__t.html">fsdp_repeat_t</a>*));
00584   }
00585   <span class="keywordflow">if</span> ( period-&gt;<a class="code" href="structfsdp__time__period__t.html#o3">repeats_count</a> &lt; <a class="code" href="formatterpriv_8h.html#a4">REPEATS_MAX_COUNT</a> ) {
00586     <span class="comment">/* FIX */</span>
00587     <a class="code" href="structfsdp__repeat__t.html">fsdp_repeat_t</a> *repeat;
00588     period-&gt;<a class="code" href="structfsdp__time__period__t.html#o2">repeats</a>[period-&gt;<a class="code" href="structfsdp__time__period__t.html#o3">repeats_count</a>] = calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="structfsdp__repeat__t.html">fsdp_repeat_t</a>));
00589     repeat = period-&gt;<a class="code" href="structfsdp__time__period__t.html#o2">repeats</a>[period-&gt;<a class="code" href="structfsdp__time__period__t.html#o3">repeats_count</a>];
00590     repeat-&gt;<a class="code" href="structfsdp__repeat__t.html#o0">interval</a> = interval;
00591     repeat-&gt;<a class="code" href="structfsdp__repeat__t.html#o1">duration</a> = duration;
00592     <span class="comment">/* TODO repeat-&gt;offsets = strdup(offsets); */</span>
00593     repeat-&gt;<a class="code" href="structfsdp__repeat__t.html#o2">offsets</a> = NULL;
00594     period-&gt;<a class="code" href="structfsdp__time__period__t.html#o3">repeats_count</a>++;
00595   }
00596   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00597 }
00598 
00599 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00600"></a><a class="code" href="group__formatter.html#a11">00600</a> <a class="code" href="group__formatter.html#a11">fsdp_set_encryption</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, fsdp_encryption_method_t emethod,
00601               <span class="keyword">const</span> <span class="keywordtype">char</span> *ekey)
00602 {
00603   <span class="keywordflow">if</span> ( (NULL == dsc) || 
00604        ((<a class="code" href="group__common.html#a10a49">FSDP_ENCRYPTION_METHOD_PROMPT</a> != emethod) 
00605      &amp;&amp; (NULL == ekey)) ) {
00606     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00607   }
00608   dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o22">k_encryption_method</a> = emethod;
00609   <span class="keywordflow">if</span> ( NULL != dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o23">k_encryption_content</a> )
00610     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o23">k_encryption_content</a>);
00611   <span class="keywordflow">if</span> ( <a class="code" href="group__common.html#a10a49">FSDP_ENCRYPTION_METHOD_PROMPT</a> != emethod )
00612     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o23">k_encryption_content</a> = strdup(ekey);
00613   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00614 }
00615 
00616 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00617"></a><a class="code" href="group__formatter.html#a12">00617</a> <a class="code" href="group__formatter.html#a12">fsdp_set_timezone_adj</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, <span class="keyword">const</span> <span class="keywordtype">char</span> *adj)
00618 {
00619   <span class="keywordflow">if</span> ( (NULL == dsc) || (NULL == adj) )
00620     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00621   <span class="keywordflow">if</span> ( NULL != dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o21">timezone_adj</a> )
00622     free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o21">timezone_adj</a>);
00623   dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o21">timezone_adj</a> = strdup(adj);
00624   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00625 }
00626 
00627 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00628"></a><a class="code" href="group__formatter.html#a13">00628</a> <a class="code" href="group__formatter.html#a13">fsdp_set_str_att</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, fsdp_session_str_att_t att,
00629            <span class="keyword">const</span> <span class="keywordtype">char</span> *value)
00630 {
00631   <span class="keywordflow">if</span> ( NULL == dsc )
00632     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00633   <span class="keywordflow">if</span> ( att &lt;= <a class="code" href="group__common.html#a16a84">FSDP_LAST_SESSION_STR_ATT</a> ) {
00634     <span class="keywordflow">if</span> ( NULL != dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o24">a_str_attributes</a>[att] )
00635       free(dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o24">a_str_attributes</a>[att]);
00636     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o24">a_str_attributes</a>[att] = strdup(value);
00637   } <span class="keywordflow">else</span> 
00638     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00639   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00640 }
00641 
00642 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00643"></a><a class="code" href="group__formatter.html#a14">00643</a> <a class="code" href="group__formatter.html#a14">fsdp_add_sdplang</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, <span class="keyword">const</span> <span class="keywordtype">char</span>* lang)
00644 {
00645   <span class="keywordflow">if</span> ( (NULL == dsc) || (NULL == lang) )
00646     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00647   
00648   <span class="keywordflow">if</span> ( NULL == dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o29">a_sdplangs</a> ) {
00649     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o30">a_sdplangs_count</a> = 0;
00650     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o29">a_sdplangs</a> = 
00651       calloc(<a class="code" href="priv_8h.html#a4">SDPLANGS_MAX_COUNT</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00652   }
00653   <span class="keywordflow">if</span> ( dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o30">a_sdplangs_count</a> &lt; <a class="code" href="priv_8h.html#a4">SDPLANGS_MAX_COUNT</a> ) {
00654     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o29">a_sdplangs</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o30">a_sdplangs_count</a>] = strdup(lang);
00655     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o30">a_sdplangs_count</a>++;
00656   }
00657   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00658 }
00659 
00660 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00661"></a><a class="code" href="group__formatter.html#a15">00661</a> <a class="code" href="group__formatter.html#a15">fsdp_add_lang</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, <span class="keyword">const</span> <span class="keywordtype">char</span>* lang)
00662 {
00663   <span class="keywordflow">if</span> ( (NULL == dsc) || (NULL == lang) )
00664     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00665   
00666   <span class="keywordflow">if</span> ( NULL == dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o31">a_langs</a> ) {
00667     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o32">a_langs_count</a> = 0;
00668     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o31">a_langs</a> = calloc(<a class="code" href="priv_8h.html#a4">SDPLANGS_MAX_COUNT</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00669   }
00670   <span class="keywordflow">if</span> ( dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o32">a_langs_count</a> &lt; <a class="code" href="priv_8h.html#a4">SDPLANGS_MAX_COUNT</a> ) {
00671     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o31">a_langs</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o32">a_langs_count</a>] = strdup(lang);
00672     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o32">a_langs_count</a>++;
00673   }
00674   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00675 }
00676 
00677 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00678"></a><a class="code" href="formatter_8c.html#a26">00678</a> <a class="code" href="formatter_8c.html#a26">fsdp_add_rtpmap</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, <span class="keyword">const</span> <span class="keywordtype">char</span>* payload_type,
00679           <span class="keyword">const</span> <span class="keywordtype">char</span> *encoding_name, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rate, 
00680           <span class="keyword">const</span> <span class="keywordtype">char</span> *parameters)
00681 {
00682   <span class="keywordflow">if</span> ( (NULL == dsc) || (NULL == encoding_name) )
00683     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00684 
00685   <span class="keywordflow">if</span> ( NULL == dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o25">a_rtpmaps</a> ) {
00686     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o26">a_rtpmaps_count</a> = 0;
00687     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o25">a_rtpmaps</a> = calloc(<a class="code" href="priv_8h.html#a3">MEDIA_RTPMAPS_MAX_COUNT</a>,<span class="keyword">sizeof</span>(<a class="code" href="structfsdp__rtpmap__t.html">fsdp_rtpmap_t</a>*));
00688   }
00689   {
00690     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o26">a_rtpmaps_count</a>;
00691     <span class="keywordflow">if</span> ( c &lt; <a class="code" href="priv_8h.html#a3">MEDIA_RTPMAPS_MAX_COUNT</a> ) {
00692       dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o25">a_rtpmaps</a>[c] = calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="structfsdp__rtpmap__t.html">fsdp_rtpmap_t</a>));
00693       dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o25">a_rtpmaps</a>[c]-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o0">pt</a> = strdup(payload_type);
00694       dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o25">a_rtpmaps</a>[c]-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o1">encoding_name</a> = strdup(encoding_name);
00695       dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o25">a_rtpmaps</a>[c]-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o2">clock_rate</a> = rate;
00696       <span class="keywordflow">if</span> ( NULL != parameters )
00697      dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o25">a_rtpmaps</a>[c]-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o3">parameters</a> = strdup(parameters);
00698       dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o26">a_rtpmaps_count</a>++;
00699     }
00700   }
00701   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00702 }
00703 
00704 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00705"></a><a class="code" href="group__formatter.html#a16">00705</a> <a class="code" href="group__formatter.html#a16">fsdp_set_sendrecv</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, fsdp_sendrecv_mode_t mode)
00706 {
00707   <span class="keywordflow">if</span> ( (NULL == dsc) )
00708     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00709   dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o27">a_sendrecv_mode</a> = mode;
00710   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00711 }
00712 
00713 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00714"></a><a class="code" href="group__formatter.html#a17">00714</a> <a class="code" href="group__formatter.html#a17">fsdp_set_session_type</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, fsdp_session_type_t type)
00715 {
00716   <span class="keywordflow">if</span> ( (NULL == dsc) )
00717     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00718   dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o28">a_type</a> = type;
00719   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00720 }
00721 
00722 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00723"></a><a class="code" href="group__formatter.html#a18">00723</a> <a class="code" href="group__formatter.html#a18">fsdp_add_media</a>(<a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc, <a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *<span class="keyword">const</span> mdsc)
00724 {
00725   <span class="keywordflow">if</span> ( (NULL == dsc) || (NULL == mdsc) )
00726     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00727   <span class="keywordflow">if</span> ( NULL == dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a> ) {
00728     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o34">media_announcements_count</a> = 0;
00729     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a> = 
00730       calloc(<a class="code" href="formatterpriv_8h.html#a5">MEDIA_ANNOUNCEMENTS_MAX_COUNT</a>,<span class="keyword">sizeof</span>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_announcement_t</a>*));
00731   }
00732   <span class="keywordflow">if</span> ( dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o34">media_announcements_count</a> &lt; <a class="code" href="formatterpriv_8h.html#a5">MEDIA_ANNOUNCEMENTS_MAX_COUNT</a> )
00733     dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o33">media_announcements</a>[dsc-&gt;<a class="code" href="structfsdp__description__t__s.html#o34">media_announcements_count</a>++] = mdsc; <span class="comment">/* FIX */</span>
00734   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00735 }
00736 
00737 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00738"></a><a class="code" href="group__formatter.html#a19">00738</a> <a class="code" href="group__formatter.html#a19">fsdp_make_media</a>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> **mdsc, fsdp_media_t type,
00739           <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> port, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> port_count, 
00740           fsdp_transport_protocol_t tp, <span class="keyword">const</span> <span class="keywordtype">char</span> *format)
00741 {
00742   <a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *obj;
00743 
00744   <span class="keywordflow">if</span> ( (NULL == mdsc) || (NULL == format) )
00745     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00746 
00747   *mdsc = calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a>));
00748   obj = *mdsc;
00749   obj-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o0">media_type</a> = type;
00750   obj-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o1">port</a> = port;
00751   obj-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o2">port_count</a> = port_count;
00752   obj-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o3">transport</a> = tp;
00753   <span class="comment">/* TODO: check that format is valid */</span>
00754   obj-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o4">formats</a> = calloc(<a class="code" href="formatterpriv_8h.html#a6">MEDIA_FORMATS_MAX_COUNT</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00755   obj-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o4">formats</a>[0] = strdup(format);
00756   obj-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o5">formats_count</a> = 1;
00757   obj-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o16">a_rtpmaps</a> = NULL;
00758   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00759 }
00760 
00761 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00762"></a><a class="code" href="group__formatter.html#a20">00762</a> <a class="code" href="group__formatter.html#a20">fsdp_add_media_format</a>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *mdsc, <span class="keyword">const</span> <span class="keywordtype">char</span> *format)
00763 {
00764   <span class="keywordflow">if</span> ( (NULL == mdsc) || (NULL == format) ) {
00765     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00766   }
00767   <span class="keywordflow">if</span> ( mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o5">formats_count</a> &lt; <a class="code" href="formatterpriv_8h.html#a6">MEDIA_FORMATS_MAX_COUNT</a> ) {
00768     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o4">formats</a>[mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o5">formats_count</a>] = strdup(format);
00769     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o5">formats_count</a>++;
00770   }
00771   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00772 }
00773 
00774 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00775"></a><a class="code" href="group__formatter.html#a21">00775</a> <a class="code" href="group__formatter.html#a21">fsdp_set_media_title</a>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *mdsc, <span class="keyword">const</span> <span class="keywordtype">char</span> *title)
00776 {
00777   <span class="keywordflow">if</span> ( (NULL == mdsc) || (NULL == title) ) {
00778     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00779   }
00780   <span class="keywordflow">if</span> ( NULL != mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o6">i_title</a> )
00781     free(mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o6">i_title</a>);
00782   mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o6">i_title</a> = strdup(title);
00783   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00784 }
00785 
00786 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00787"></a><a class="code" href="group__formatter.html#a22">00787</a> <a class="code" href="group__formatter.html#a22">fsdp_set_media_conn_address</a>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *mdsc,
00788                    fsdp_network_type_t nt, fsdp_address_type_t at, 
00789                    <span class="keyword">const</span> <span class="keywordtype">char</span> *address, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> address_ttl, 
00790                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> address_count)
00791 {
00792   <span class="keywordflow">if</span> ( (NULL == mdsc) || (NULL == address) ) {
00793     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00794   }
00795   mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o7">c_network_type</a> = nt;
00796   mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o8">c_address_type</a> = at;
00797   <span class="keywordflow">if</span> ( NULL != mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o9">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o0">address</a> )
00798     free(mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o9">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o0">address</a>);
00799   mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o9">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o0">address</a> = strdup(address);
00800   mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o9">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o1">address_ttl</a> = address_ttl;
00801   mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o9">c_address</a>.<a class="code" href="structfsdp__connection__address__t__s.html#o2">address_count</a> = address_count;
00802   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00803 }
00804 
00805 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00806"></a><a class="code" href="group__formatter.html#a23">00806</a> <a class="code" href="group__formatter.html#a23">fsdp_add_media_bw_info</a>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *mdsc, 
00807                  fsdp_bw_modifier_type_t mt,
00808                  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> value, <span class="keyword">const</span> <span class="keywordtype">char</span> *unk_bmt)
00809 {
00810   <span class="keywordflow">if</span> ( (NULL == mdsc) ||
00811        ((<a class="code" href="group__common.html#a9a40">FSDP_BW_MOD_TYPE_UNKNOWN</a> == mt) &amp;&amp; (NULL == unk_bmt)) ) {
00812     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00813   }
00814   <span class="keywordflow">if</span> ( NULL == mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o10">bw_modifiers</a> ) {
00815     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o11">bw_modifiers_count</a> = 0;
00816     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o10">bw_modifiers</a> = calloc(<a class="code" href="formatterpriv_8h.html#a2">BW_MODIFIERS_MAX_COUNT</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00817   }
00818   <span class="keywordflow">if</span> ( mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o11">bw_modifiers_count</a> &lt; <a class="code" href="formatterpriv_8h.html#a2">BW_MODIFIERS_MAX_COUNT</a> ) { <span class="comment">/* FIX */</span>
00819     <a class="code" href="structfsdp__bw__modifier__t.html">fsdp_bw_modifier_t</a> *bwm = &amp;(mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o10">bw_modifiers</a>[mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o11">bw_modifiers_count</a>]);
00820     bwm-&gt;<a class="code" href="structfsdp__bw__modifier__t.html#o0">b_mod_type</a> = mt;
00821     bwm-&gt;<a class="code" href="structfsdp__bw__modifier__t.html#o1">b_value</a> = value;
00822     <span class="keywordflow">if</span> ( <a class="code" href="group__common.html#a9a40">FSDP_BW_MOD_TYPE_UNKNOWN</a>== mt) {
00823       bwm-&gt;<a class="code" href="structfsdp__bw__modifier__t.html#o2">b_unknown_bw_modt</a> = strdup(unk_bmt);
00824     }
00825     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o11">bw_modifiers_count</a>++;
00826   }
00827   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00828 }
00829 
00830 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00831"></a><a class="code" href="group__formatter.html#a24">00831</a> <a class="code" href="group__formatter.html#a24">fsdp_set_media_encryption</a>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *mdsc,
00832                  fsdp_encryption_method_t emethod, <span class="keyword">const</span> <span class="keywordtype">char</span> *ekey)
00833 {
00834   <span class="keywordflow">if</span> ( (NULL == mdsc) || 
00835        ((<a class="code" href="group__common.html#a10a49">FSDP_ENCRYPTION_METHOD_PROMPT</a> != emethod) 
00836      &amp;&amp; (NULL == ekey)) ) {
00837     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00838   }
00839   mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o12">k_encryption_method</a> = emethod;
00840   <span class="keywordflow">if</span> ( NULL != mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o13">k_encryption_content</a> )
00841     free(mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o13">k_encryption_content</a>);
00842   <span class="keywordflow">if</span> ( <a class="code" href="group__common.html#a10a49">FSDP_ENCRYPTION_METHOD_PROMPT</a> != emethod )
00843     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o13">k_encryption_content</a> = strdup(ekey);
00844   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00845 }
00846 
00847 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00848"></a><a class="code" href="group__formatter.html#a25">00848</a> <a class="code" href="group__formatter.html#a25">fsdp_set_media_ptime</a>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *mdsc, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ptime)
00849 {
00850   <span class="keywordflow">if</span> ( (NULL == mdsc) )
00851     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00852   mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o14">a_ptime</a> = ptime;
00853   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00854 }
00855 
00856 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00857"></a><a class="code" href="group__formatter.html#a26">00857</a> <a class="code" href="group__formatter.html#a26">fsdp_set_media_maxptime</a>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *mdsc, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxptime)
00858 {
00859   <span class="keywordflow">if</span> ( (NULL == mdsc) )
00860     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00861   mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o15">a_maxptime</a> = maxptime;
00862   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00863 }
00864 
00865 
00866 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00867"></a><a class="code" href="group__formatter.html#a27">00867</a> <a class="code" href="group__formatter.html#a27">fsdp_add_media_fmtp</a>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *mdsc, <span class="keyword">const</span> <span class="keywordtype">char</span>* fmtp)
00868 {
00869   <span class="keywordflow">if</span> ( (NULL == mdsc) || (NULL == fmtp) )
00870     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00871   
00872   <span class="keywordflow">if</span> ( NULL == mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o26">a_fmtps</a> ) {
00873     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o27">a_fmtps_count</a> = 0;
00874     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o26">a_fmtps</a> = calloc(<a class="code" href="priv_8h.html#a4">SDPLANGS_MAX_COUNT</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00875   }
00876   <span class="keywordflow">if</span> ( mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o27">a_fmtps_count</a> &lt; <a class="code" href="priv_8h.html#a4">SDPLANGS_MAX_COUNT</a> ) {
00877     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o26">a_fmtps</a>[mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o27">a_fmtps_count</a>] = strdup(fmtp);
00878     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o27">a_fmtps_count</a>++;
00879   }
00880   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00881 }
00882 
00883 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00884"></a><a class="code" href="group__formatter.html#a28">00884</a> <a class="code" href="group__formatter.html#a28">fsdp_set_media_orient</a>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *mdsc, fsdp_orient_t orient)
00885 {
00886   <span class="keywordflow">if</span> ( (NULL == mdsc) )
00887     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00888   mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o18">a_orient</a> = orient;
00889   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00890 }
00891 
00892 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00893"></a><a class="code" href="group__formatter.html#a29">00893</a> <a class="code" href="group__formatter.html#a29">fsdp_add_media_sdplang</a>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *mdsc, <span class="keyword">const</span> <span class="keywordtype">char</span>* lang)
00894 {
00895   <span class="keywordflow">if</span> ( (NULL == mdsc) || (NULL == lang) )
00896     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00897   
00898   <span class="keywordflow">if</span> ( NULL == mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o20">a_sdplangs</a> ) {
00899     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o21">a_sdplangs_count</a> = 0;
00900     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o20">a_sdplangs</a> = 
00901       calloc(<a class="code" href="priv_8h.html#a4">SDPLANGS_MAX_COUNT</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00902   }
00903   <span class="keywordflow">if</span> ( mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o21">a_sdplangs_count</a> &lt; <a class="code" href="priv_8h.html#a4">SDPLANGS_MAX_COUNT</a> ) {
00904     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o20">a_sdplangs</a>[mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o21">a_sdplangs_count</a>] = strdup(lang);
00905     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o21">a_sdplangs_count</a>++;
00906   }
00907   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00908 }
00909 
00910 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00911"></a><a class="code" href="group__formatter.html#a30">00911</a> <a class="code" href="group__formatter.html#a30">fsdp_add_media_lang</a>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *mdsc, <span class="keyword">const</span> <span class="keywordtype">char</span>* lang)
00912 {
00913   <span class="keywordflow">if</span> ( (NULL == mdsc) || (NULL == lang) )
00914     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00915   
00916   <span class="keywordflow">if</span> ( NULL == mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o22">a_langs</a> ) {
00917     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o23">a_langs_count</a> = 0;
00918     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o22">a_langs</a> = calloc(<a class="code" href="priv_8h.html#a4">SDPLANGS_MAX_COUNT</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
00919   }
00920   <span class="keywordflow">if</span> ( mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o23">a_langs_count</a> &lt; <a class="code" href="priv_8h.html#a4">SDPLANGS_MAX_COUNT</a> ) {
00921     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o22">a_langs</a>[mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o23">a_langs_count</a>] = strdup(lang);
00922     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o23">a_langs_count</a>++;
00923   }
00924   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00925 }
00926 
00927 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00928"></a><a class="code" href="group__formatter.html#a31">00928</a> <a class="code" href="group__formatter.html#a31">fsdp_set_media_sendrecv</a>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *mdsc,
00929                fsdp_sendrecv_mode_t mode)
00930 {
00931   <span class="keywordflow">if</span> ( (NULL == mdsc) )
00932     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00933   mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o19">a_sendrecv_mode</a> = mode;
00934   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00935 }
00936 
00937 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00938"></a><a class="code" href="group__formatter.html#a32">00938</a> <a class="code" href="group__formatter.html#a32">fsdp_set_media_framerate</a>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *mdsc, <span class="keywordtype">float</span> rate)
00939 {
00940   <span class="keywordflow">if</span> ( (NULL == mdsc) )
00941     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00942   mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o24">a_framerate</a> = rate;
00943   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00944 }
00945 
00946 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00947"></a><a class="code" href="group__formatter.html#a33">00947</a> <a class="code" href="group__formatter.html#a33">fsdp_set_media_quality</a>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *mdsc, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q)
00948 {
00949   <span class="keywordflow">if</span> ( (NULL == mdsc) )
00950     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00951   mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o25">a_quality</a> = q;
00952   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00953 }
00954 
00955 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00956"></a><a class="code" href="group__formatter.html#a34">00956</a> <a class="code" href="group__formatter.html#a34">fsdp_add_media_rtpmap</a>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *mdsc, <span class="keyword">const</span> <span class="keywordtype">char</span>* payload_type,
00957                 <span class="keyword">const</span> <span class="keywordtype">char</span> *encoding_name, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rate, 
00958                 <span class="keyword">const</span> <span class="keywordtype">char</span> *parameters)
00959 {
00960   <span class="keywordflow">if</span> ( (NULL == mdsc) || (NULL == encoding_name) )
00961     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00962 
00963   <span class="keywordflow">if</span> ( NULL == mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o16">a_rtpmaps</a> ) {
00964     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o17">a_rtpmaps_count</a> = 0;
00965     mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o16">a_rtpmaps</a> = calloc(<a class="code" href="priv_8h.html#a3">MEDIA_RTPMAPS_MAX_COUNT</a>,<span class="keyword">sizeof</span>(<a class="code" href="structfsdp__rtpmap__t.html">fsdp_rtpmap_t</a>*));
00966   }
00967   {
00968     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o17">a_rtpmaps_count</a>;
00969     <span class="keywordflow">if</span> ( c &lt; <a class="code" href="priv_8h.html#a3">MEDIA_RTPMAPS_MAX_COUNT</a> ) {
00970       mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o16">a_rtpmaps</a>[c] = calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="structfsdp__rtpmap__t.html">fsdp_rtpmap_t</a>));
00971       mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o16">a_rtpmaps</a>[c]-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o0">pt</a> = strdup(payload_type);
00972       mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o16">a_rtpmaps</a>[c]-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o1">encoding_name</a> = strdup(encoding_name);
00973       mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o16">a_rtpmaps</a>[c]-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o2">clock_rate</a> = rate;
00974       <span class="keywordflow">if</span> ( NULL != parameters )
00975      mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o16">a_rtpmaps</a>[c]-&gt;<a class="code" href="structfsdp__rtpmap__t.html#o3">parameters</a> = strdup(parameters);
00976       mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o17">a_rtpmaps_count</a>++;
00977     }
00978   }
00979   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00980 }
00981 
00982 <a class="code" href="group__common.html#a6">fsdp_error_t</a>
<a name="l00983"></a><a class="code" href="group__formatter.html#a35">00983</a> <a class="code" href="group__formatter.html#a35">fsdp_set_media_rtcp</a>(<a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *mdsc, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> port,
00984               fsdp_network_type_t nt, fsdp_address_type_t at,
00985               <span class="keyword">const</span> <span class="keywordtype">char</span> *address)
00986 {
00987   <span class="keywordflow">if</span> ( (NULL == mdsc) || (NULL == address) )
00988     <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a32">FSDPE_INVALID_PARAMETER</a>;
00989   mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o28">a_rtcp_port</a> = port;
00990   mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o29">a_rtcp_network_type</a> = nt;
00991   mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o30">a_rtcp_address_type</a> = at;
00992   <span class="keywordflow">if</span> ( NULL != mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o31">a_rtcp_address</a> )
00993     free(mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o31">a_rtcp_address</a>);
00994   mdsc-&gt;<a class="code" href="structfsdp__media__description__t__s.html#o31">a_rtcp_address</a> = strdup(address);
00995   <span class="keywordflow">return</span> <a class="code" href="group__common.html#a6a4">FSDPE_OK</a>;
00996 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Jan 18 21:12:43 2004 for FreeSDP by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
