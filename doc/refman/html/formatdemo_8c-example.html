<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>FreeSDP: Example Documentation</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>formatdemo.c</h1>A basic SDP descriptions formatter based on FreeSDP. <div class="fragment"><pre><span class="comment">/*</span>
<span class="comment">  formatdemo - An example on how to use FreeSDP to format SDP descriptions.</span>
<span class="comment">  Copyright (C) 2002,2003 Federico Montesino Pouzols &lt;fedemp@altern.org&gt;</span>
<span class="comment">  </span>
<span class="comment">  This program is free software; you can redistribute it and/or modify</span>
<span class="comment">  it under the terms of the GNU General Public License as published by</span>
<span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>
<span class="comment">  (at your option) any later version.</span>
<span class="comment">  </span>
<span class="comment">  This program is distributed in the hope that it will be useful,</span>
<span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment">  GNU General Public License for more details.</span>
<span class="comment">  </span>
<span class="comment">  You should have received a copy of the GNU General Public License</span>
<span class="comment">  along with this program; if not, write to the Free Software</span>
<span class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<span class="comment">*/</span>

<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="formatter_8h.html">freesdp/formatter.h</a>&gt;</span>

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
{
  <a name="_a0"></a><a class="code" href="structfsdp__description__t__s.html">fsdp_description_t</a> *dsc = NULL;
  <a name="_a1"></a><a class="code" href="structfsdp__media__description__t__s.html">fsdp_media_description_t</a> *mdsc1 = NULL, *mdsc2 = NULL;
  <span class="keywordtype">char</span> *text = NULL;
  <a class="code" href="group__common.html#a6">fsdp_error_t</a> result;

  printf(<span class="stringliteral">" Beginning to print a new SDP description...\n"</span>);

  <span class="comment">/* With this routine we set the mandatory fields in the description */</span>
  <span class="comment">/* Note that fsdp_make_description allocates a new description object in</span>
<span class="comment">     *dsc */</span>
  <a name="a2"></a><a class="code" href="group__formatter.html#a0">fsdp_make_description</a>(&amp;dsc,0,<span class="stringliteral">"A test session"</span>,<span class="stringliteral">"1000000000"</span>,<span class="stringliteral">"1111111111"</span>,
               <span class="stringliteral">"userfoo"</span>,FSDP_NETWORK_TYPE_INET,
               FSDP_ADDRESS_TYPE_IPV4,<span class="stringliteral">"127.0.0.1"</span>,
               time(NULL),time(NULL)+36000);

  <span class="comment">/* Now, we can set additional fields */</span>
  <a name="a3"></a><a class="code" href="group__formatter.html#a3">fsdp_set_information</a>(dsc,<span class="stringliteral">"This is just a test multimedia session."</span>);
  <a name="a4"></a><a class="code" href="group__formatter.html#a17">fsdp_set_session_type</a>(dsc,FSDP_SESSION_TYPE_MODERATED);
  <a name="a5"></a><a class="code" href="group__formatter.html#a4">fsdp_set_uri</a>(dsc,<span class="stringliteral">"http://www.example.com/foo/user.html"</span>);
  <a name="a6"></a><a class="code" href="group__formatter.html#a5">fsdp_add_email</a>(dsc,<span class="stringliteral">"user1@foo.example.com (User 1)"</span>);
  <a class="code" href="group__formatter.html#a5">fsdp_add_email</a>(dsc,<span class="stringliteral">"user2@foo.example.com (User 2)"</span>);
  <a name="a7"></a><a class="code" href="group__formatter.html#a6">fsdp_add_phone</a>(dsc,<span class="stringliteral">"+11 111 11 11 11"</span>);

  <a name="a8"></a><a class="code" href="group__formatter.html#a7">fsdp_set_conn_address</a>(dsc,FSDP_NETWORK_TYPE_INET,FSDP_ADDRESS_TYPE_IPV4,
               <span class="stringliteral">"127.0.0.3"</span>,0,0);
  <a name="a9"></a><a class="code" href="group__formatter.html#a16">fsdp_set_sendrecv</a>(dsc,FSDP_SENDRECV_SENDRECV);

  <span class="comment">/* and also media descriptions */</span>
  <a name="a10"></a><a class="code" href="group__formatter.html#a19">fsdp_make_media</a>(&amp;mdsc1,FSDP_MEDIA_AUDIO,30000,0,FSDP_TP_RTP_AVP,<span class="stringliteral">"96"</span>);
  <a name="a11"></a><a class="code" href="group__formatter.html#a20">fsdp_add_media_format</a>(mdsc1,<span class="stringliteral">"97"</span>);
  <a class="code" href="group__formatter.html#a20">fsdp_add_media_format</a>(mdsc1,<span class="stringliteral">"98"</span>);
  <a name="a12"></a><a class="code" href="group__formatter.html#a34">fsdp_add_media_rtpmap</a>(mdsc1,<span class="stringliteral">"96"</span>,<span class="stringliteral">"PCMA"</span>,8000,NULL);
  <a class="code" href="group__formatter.html#a34">fsdp_add_media_rtpmap</a>(mdsc1,<span class="stringliteral">"97"</span>,<span class="stringliteral">"PCMU"</span>,8000,NULL);
  <a class="code" href="group__formatter.html#a34">fsdp_add_media_rtpmap</a>(mdsc1,<span class="stringliteral">"98"</span>,<span class="stringliteral">"L6"</span>,11025,<span class="stringliteral">"2"</span>);
  <a name="a13"></a><a class="code" href="group__formatter.html#a21">fsdp_set_media_title</a>(mdsc1,<span class="stringliteral">"An audio example."</span>);
  <a name="a14"></a><a class="code" href="group__formatter.html#a23">fsdp_add_media_bw_info</a>(mdsc1,FSDP_BW_MOD_TYPE_CONFERENCE_TOTAL,64000,NULL);
  <a name="a15"></a><a class="code" href="group__formatter.html#a25">fsdp_set_media_ptime</a>(mdsc1,20);
  <a name="a16"></a><a class="code" href="group__formatter.html#a26">fsdp_set_media_maxptime</a>(mdsc1,40);

  <a class="code" href="group__formatter.html#a19">fsdp_make_media</a>(&amp;mdsc2,FSDP_MEDIA_VIDEO,31000,0,FSDP_TP_RTP_AVP,<span class="stringliteral">"0"</span>);
  <a class="code" href="group__formatter.html#a21">fsdp_set_media_title</a>(mdsc2,<span class="stringliteral">"A video example."</span>);
  <a name="a17"></a><a class="code" href="group__formatter.html#a22">fsdp_set_media_conn_address</a>(mdsc2,FSDP_NETWORK_TYPE_INET,
                     FSDP_ADDRESS_TYPE_IPV4,<span class="stringliteral">"127.0.0.5"</span>,0,0);
  <a name="a18"></a><a class="code" href="group__formatter.html#a31">fsdp_set_media_sendrecv</a>(mdsc2,FSDP_SENDRECV_SENDONLY);
  <a name="a19"></a><a class="code" href="group__formatter.html#a24">fsdp_set_media_encryption</a>(mdsc2,FSDP_ENCRYPTION_METHOD_URI,
                   <span class="stringliteral">"http://www.example.com/key"</span>);

  <a name="a20"></a><a class="code" href="group__formatter.html#a18">fsdp_add_media</a>(dsc,mdsc1);
  <a class="code" href="group__formatter.html#a18">fsdp_add_media</a>(dsc,mdsc2);

  <span class="comment">/* Print SDP into memory. Note that fsdp_format allocates memory for *text */</span>
  result = <a name="a21"></a><a class="code" href="group__formatter.html#a1">fsdp_format</a>(dsc,&amp;text);

  <span class="keywordflow">if</span> ( result == <a class="code" href="group__common.html#a6a4">FSDPE_OK</a> ) {
    printf(<span class="stringliteral">" completed succesfully!\n Below is the description:\n"</span>);
    printf(<span class="stringliteral">"------------------------------------\n"</span>);
  } <span class="keywordflow">else</span> {
    printf(<span class="stringliteral">" failed with error code %d: %s.\n"</span>,result,<a name="a22"></a><a class="code" href="group__common.html#a5">fsdp_strerror</a>(result));
    printf(<span class="stringliteral">" Below is what could be formatted:\n"</span>);
    printf(<span class="stringliteral">"------------------------------------\n"</span>);
  }

  <span class="comment">/* Dump textual SDP description to screen */</span>
  printf(text);

  <span class="comment">/* Free allocated description object and text */</span>
  <a name="a23"></a><a class="code" href="group__common.html#a3">fsdp_description_delete</a>(dsc);
  free(text);

  <span class="keywordflow">return</span> 0;
}
</pre></div> <hr size="1"><address style="align: right;"><small>Generated on Sun Jan 18 21:12:43 2004 for FreeSDP by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
